<!DOCTYPE html>
<html>
<head>
  <title>Show Me Your Knowledge Online Tool</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="ShowMeYourKnowledge.css">

		<link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  	<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
	</head>
	<body class="mdc-typography">
			
			<form id="formDiv" onsubmit="event.preventDefault(); updateData()">

				<span class="mdc-typography--headline2">Input your data</span>

				<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
					<span class="mdc-notched-outline">
						<span class="mdc-notched-outline__leading"></span>
						<span class="mdc-notched-outline__notch">
							<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
								X-axis label
							</span>
						</span>
						<span class="mdc-notched-outline__trailing"></span>
					</span>
					<input id="xAxis" name="xAxis" type="text" class="mdc-text-field__input" aria-labelledby="my-label-id" value="Age group">
				</label>

				<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
					<span class="mdc-notched-outline">
						<span class="mdc-notched-outline__leading"></span>
						<span class="mdc-notched-outline__notch">
							<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
								Y-axis label
							</span>
						</span>
						<span class="mdc-notched-outline__trailing"></span>
					</span>
					<input id="yAxis" name="yAxis" type="text" class="mdc-text-field__input" aria-labelledby="my-label-id" value="Number of cases">
				</label>

				<div class="helperTextDiv">
					<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
						<span class="mdc-notched-outline">
							<span class="mdc-notched-outline__leading"></span>
							<span class="mdc-notched-outline__notch">
								<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
									Input your data
								</span>
							</span>
							<span class="mdc-notched-outline__trailing"></span>
						</span>
						<span class="mdc-text-field__resizer">
							<textarea 
								aria-controls="dataHelperId"
								aria-describedby="dataHelperId" 
								id="data" name="data" class="mdc-text-field__input" rows="8" cols="40" aria-label="Label" wrap="hard" aria-controls="my-helper-id"
							aria-describedby="my-helper-id">0-19,113750&#13;20-29,161355&#13;30-39,154483&#13;40-49,153037&#13;50-59,142577&#13;60-69,83979&#13;70-97,55547&#13;80+,81058</textarea>
						</span>
					</label>
					<div class="mdc-text-field-helper-line">
						<div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" id="dataHelperId" aria-hidden="true">Every line should contain 1 category with it's corresponding value seperated by a comma</div>
					</div>
				</div>

				<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
					<span class="mdc-notched-outline">
						<span class="mdc-notched-outline__leading"></span>
						<span class="mdc-notched-outline__notch">
							<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
								Starting value
							</span>
						</span>
						<span class="mdc-notched-outline__trailing"></span>
					</span>
					<input id="startingValue" name="startingValue" type="number" class="mdc-text-field__input" aria-labelledby="my-label-id" value="20000">
				</label>

				<div class="helperTextDiv">
					<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
						<span class="mdc-notched-outline">
							<span class="mdc-notched-outline__leading"></span>
							<span class="mdc-notched-outline__notch">
								<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
									Hint bar
								</span>
							</span>
							<span class="mdc-notched-outline__trailing"></span>
						</span>
						<input 
								aria-controls="hintHelperId"
								aria-describedby="hintHelperId" 
								id="hint" name="hint" type="number" class="mdc-text-field__input" aria-labelledby="my-label-id" value="6">
					</label>
					<div class="mdc-text-field-helper-line">
						<div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" id="hintHelperId" aria-hidden="true">Give the number of the bar you want to provide as a hint (Leftmost bar is number 1)
						</div>
					</div>
				</div>

				<div class="helperTextDiv">
					<label class="mdc-text-field mdc-text-field--outlined mdc-text-field--label-floating" data-mdc-auto-init="MDCTextField">
						<span class="mdc-notched-outline">
							<span class="mdc-notched-outline__leading"></span>
							<span class="mdc-notched-outline__notch">
								<span class="mdc-floating-label mdc-floating-label--float-above" id="my-label-id">
									Units
								</span>
							</span>
							<span class="mdc-notched-outline__trailing"></span>
						</span>
						<input aria-controls="unitsHelperId"
							aria-describedby="unitsHelperId" 
							id="units" name="units" type="text" class="mdc-text-field__input" aria-labelledby="my-label-id" value="cases">
					</label>
					<div class="mdc-text-field-helper-line">
						<div class="mdc-text-field-helper-text mdc-text-field-helper-text--persistent" id="unitsHelperId" aria-hidden="true">Used for textual feedback when hovering
						</div>
					</div>
				</div>

				<button class="mdc-button mdc-button--raised">
					<span class="mdc-button__label">Update</span>
				</button>
				
			</form>

		<div id="rightSideDiv">
			<div class="previewDivWithHeader">
				<div class="mdc-typography--headline2 rightSideHeaderPreview">Preview</div>

				<div id="iFrameDiv">
					<span></span>
					<iframe id='iFrameID'  style="width:940px; height:507px;" frameborder=0></iframe>
					<span></span>
				</div>
			</div>
			
			<div class="outputDivWithHeader">
				<div class="mdc-typography--headline2 rightSideHeaderOutput">Ouput</div>
				
				<div class="outputDiv">
					<div class="outputSubDiv">
						<span class="mdc-typography--headline2 outputSubHeader">View & share online</span>

						<div class="outputBtnDiv">
							<button class="mdc-button mdc-button--raised outputBtn" onclick="goToSite();">
								<span class="mdc-button__label">Go to site</span>
							</button>
							<span id="outputBtnSpace"></span>
							<button class="mdc-button mdc-button--raised outputBtn" onclick="copyURL();">
								<span class="mdc-button__label">Copy url</span>
							</button>
						</div>

					</div>
					<span id="outputDivSpace"></span>
					<div class="outputSubDiv">
						<span class="mdc-typography--headline2 outputSubHeader">Embed into your own site</span>

						<div class="outputBtnDiv">
							<button class="mdc-button mdc-button--raised outputBtn" onclick="copyIFrameCode();">
								<span class="mdc-button__label">Copy iFrame code</span>
							</button>
						</div>
					</div>
				</div>
			</div>

		</div>

		<script type="text/javascript">
			window.mdc.autoInit();
		</script>

		<script>
			var finalURL = "";
			var finalIFrameCode = "";

			function sendData() {
				const visualisationURL = "https://jonathandelm.github.io/SMYK/SMYK";

				var xAxisName = document.getElementById("xAxis").value;
				var yAxisName = document.getElementById("yAxis").value;

				var dataString = document.getElementById("data").value;
				var array = dataString.split(/\r?\n/);
				var data = [];
				array.forEach(e => {
					var line = e.split(',');
					var val = {};
					val.name = line[0];
					val.value = line[1];
					data.push(val);
				});

				var startingValue = document.getElementById("startingValue").value;
				var hint = document.getElementById("hint").value;
				var units = document.getElementById("units").value;

				var dataObj = {
					'data': data,
					'initialEstValue': startingValue,
					'xAxisName': xAxisName,
					'yAxisName': yAxisName,
					'hintBarID': hint,
					'unitName': units
				};

				var iframeWin = document.getElementById("iFrameID");
				var base64string = btoa(JSON.stringify(dataObj));

				var url = visualisationURL + "?params=" + base64string;
				iframeWin.src = url;
				finalURL = url;

				finalIFrameCode = "<iframe src='"+ url +"' id='iFrameID' frameborder='0' width='100%' height='507px'></iframe>";
			}

			window.onload = function () {
				sendData();
			};

			function updateData() {
				sendData();
			}

			function goToSite() {
				window.open(finalURL);
			}

			function copyURL() {
				navigator.clipboard.writeText(finalURL);
			}

			function copyIFrameCode() {
				navigator.clipboard.writeText(finalIFrameCode);
			}
		</script>
	</body>
</html>